# PyInstaller 打包说明

## 🎯 打包目标

将教学大纲生成系统打包成独立的可执行文件，无需Python环境即可运行。

## 📁 打包文件说明

### 核心文件
- `app.spec` - PyInstaller配置文件
- `version_info.txt` - 程序版本信息
- `build.bat` - 完整打包脚本（推荐）
- `quick_build.bat` - 快速打包脚本

### 打包命令
```bash
# 方法1：使用自动化脚本（推荐）
build.bat

# 方法2：使用快速脚本
quick_build.bat

# 方法3：手动命令
pyinstaller app.spec --onefile --clean --noconfirm
```

## 🚀 使用步骤

### 1. 环境准备
```bash
# 确保虚拟环境正常
setup_venv.bat

# 或手动激活环境
.venv\Scripts\activate.bat
pip install -r requirements.txt
```

### 2. 执行打包
```bash
# 运行完整打包脚本
build.bat

# 或快速打包
quick_build.bat
```

### 3. 打包结果
打包完成后，文件会输出到 `release` 目录：
```
release/
├── 单文件版本/
│   ├── 教学大纲生成系统.exe
│   └── config.ini
├── 目录版本/          # 可选
│   └── 教学大纲生成系统/
├── 配置文件/
│   └── config.ini
└── 使用说明/
    ├── README.md
    └── 快速启动指南.md
```

## ⚙️ 配置说明

### 端口配置防冲突
系统支持自动端口检测：
- 主端口：5000（在config.ini中配置）
- 备用端口：5001-5005
- 自动分配：如果预设端口都被占用，自动分配5006-5019

### 配置文件 (config.ini)
```ini
[server]
host = 127.0.0.1
port = 5000
backup_ports = 5001,5002,5003,5004,5005

[app]
auto_open_browser = true
default_page = /teaching-outline
```

## 🎮 运行方式

### 打包后运行
1. **单文件版本**（推荐）
   - 双击 `教学大纲生成系统.exe`
   - 无需额外文件，便于分发

2. **目录版本**
   - 进入目录后运行 `教学大纲生成系统.exe`
   - 启动更快，但需要整个目录

### 运行特点
- ✅ 自动检测可用端口
- ✅ 自动打开浏览器
- ✅ 支持配置文件自定义
- ✅ 控制台显示详细信息
- ✅ 优雅的错误处理

## 🔧 技术细节

### PyInstaller配置要点
1. **数据文件包含**
   - Flask模板：`app/web_templates`
   - 静态文件：`app/static`
   - Word模板：`app/templates`
   - 配置文件：`config.ini`

2. **隐藏导入模块**
   - Flask及其依赖
   - python-docx相关
   - 应用自定义模块

3. **排除模块**
   - GUI框架（tkinter, PyQt等）
   - 科学计算库（numpy, pandas等）
   - 其他大型无关库

### 打包模式对比
| 模式 | 优点 | 缺点 | 适用场景 |
|------|------|------|----------|
| 单文件 | 分发简单，一个文件 | 启动较慢，首次解压 | 最终发布 |
| 目录 | 启动快，修改方便 | 文件多，分发复杂 | 开发测试 |

## 🛡️ 安全和兼容性

### 系统要求
- Windows 10/11 (64位)
- 无需Python环境
- 需要网络连接（调用AI接口）

### 安全特性
- 仅本地运行，不对外暴露
- 配置文件本地存储
- 生成文档本地保存

### 兼容性测试
- [x] Windows 10 21H2
- [x] Windows 11 22H2
- [x] 各种端口占用情况
- [x] 不同AI接口配置

## 📊 性能优化

### 启动性能
- 单文件模式：3-5秒
- 目录模式：1-2秒
- 内存占用：约150-200MB

### 打包优化
- UPX压缩：减小文件大小
- 模块排除：去除无关依赖
- 资源优化：仅包含必要文件

## 🚨 故障排除

### 常见问题

1. **打包失败**
   ```
   解决：检查虚拟环境，重新安装依赖
   命令：setup_venv.bat
   ```

2. **运行时找不到模块**
   ```
   解决：检查hiddenimports配置
   位置：app.spec文件
   ```

3. **端口被占用**
   ```
   解决：系统自动处理，或修改config.ini
   ```

4. **浏览器不自动打开**
   ```
   解决：手动访问控制台显示的地址
   地址：http://127.0.0.1:端口号/teaching-outline
   ```

### 调试方法
1. 查看控制台输出
2. 检查错误日志
3. 验证配置文件
4. 测试开发环境

## 📈 版本历史

### v1.0.0
- ✅ 基础打包功能
- ✅ 端口自动检测
- ✅ 配置文件支持
- ✅ 自动打开浏览器
- ✅ 完整的错误处理

## 🔮 后续计划

- [ ] 添加应用图标
- [ ] 优化启动速度
- [ ] 支持自动更新
- [ ] 添加安装包制作
- [ ] 支持Linux/Mac打包