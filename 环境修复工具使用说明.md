# 教学大纲生成系统 - 环境修复工具

当您将项目移动到新目录、新电脑或Python环境发生变化时，使用这些工具可以自动检查并修复虚拟环境。

## 🚀 快速使用

### 方法一：通用环境修复（推荐）
双击运行 `setup_venv.bat` 文件，脚本会自动：
- 检查Python环境和路径
- 验证虚拟环境状态和路径一致性
- 自动修复损坏或路径不一致的虚拟环境
- 重新安装依赖包
- 测试应用是否正常工作

### 方法二：使用PowerShell脚本（功能更强大）
右键点击 `setup_venv.ps1` → "使用PowerShell运行"
或在PowerShell中运行：
```powershell
.\setup_venv.ps1
```

### 方法三：快速启动
环境修复完成后，可以使用 `start_app.bat` 快速启动应用。

## 📋 工具说明

### setup_venv.bat
- **功能**: 全面的环境检查与修复（包含路径检查）
- **支持**: Windows 批处理
- **特点**: 简单易用，双击运行，功能全面
- **适用**: 所有环境问题，包括路径不一致

### setup_venv.ps1
- **功能**: 高级环境检查与修复（包含路径检查）
- **支持**: PowerShell（Windows 10+）
- **特点**: 更详细的错误信息和修复建议
- **适用**: 需要详细诊断信息的所有环境问题

### start_app.bat
- **功能**: 快速启动应用
- **前提**: 虚拟环境已正确设置
- **特点**: 一键启动

## 🔧 解决的问题

### 1. 项目路径变化
- 从 `D:\Qoder_Project` 移动到 `C:\MyProjects`
- 虚拟环境路径失效
- **解决**: 自动检测并重新创建虚拟环境

### 2. Python版本变化
- 系统Python从3.9升级到3.11
- 虚拟环境Python路径失效
- **解决**: 检测Python版本并重建环境

### 3. 依赖包问题
- 包版本冲突
- 关键依赖缺失
- **解决**: 重新安装所有依赖包

### 4. 跨电脑迁移
- 不同电脑的Python安装路径不同
- 虚拟环境无法在新电脑使用
- **解决**: 完全重建适合新环境的虚拟环境

## 🛠️ 使用场景

### 场景1：项目目录迁移
```bash
# 原路径: D:\Qoder_Project\agent_CourseOutline
# 新路径: C:\Projects\agent_CourseOutline
# 操作: 双击 setup_venv.bat
```

### 场景2：新电脑部署
```bash
# 1. 复制整个项目文件夹到新电脑
# 2. 确保新电脑已安装Python 3.10+
# 3. 双击 setup_venv.bat
# 4. 等待自动配置完成
```

### 场景3：Python版本升级
```bash
# 升级Python后虚拟环境失效
# 操作: 运行 fix_venv_path.bat 专门修复路径问题
# 或者: 运行 setup_venv.bat 重建环境
```

### 场景4：虚拟环境路径不一致
```bash
# 现在已整合到主要修复工具中
# 操作: 运行 setup_venv.bat 或 setup_venv.ps1
# 工具会自动检测路径差异并重建虚拟环境
```

## ⚙️ 高级配置

### 网络问题解决
如果依赖安装失败，可以手动使用国内镜像：
```bash
# 激活虚拟环境后运行
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple/
```

### 权限问题解决
如果遇到权限问题：
1. 以管理员身份运行脚本
2. 或将项目移动到用户目录下

### 自定义Python路径
如果系统有多个Python版本，可以修改脚本中的`python`命令为特定路径：
```bash
# 例如使用特定Python版本
C:\Python311\python.exe -m venv .venv
```

## 📊 检查项目

脚本会自动检查以下项目：
- ✅ Python版本（建议3.10+）
- ✅ 虚拟环境状态
- ✅ 关键依赖包（Flask, requests, python-docx等）
- ✅ 依赖版本兼容性
- ✅ 应用模块导入
- ✅ 项目文件完整性

## 🚨 常见错误及解决

### 错误1: "Python未安装"
**解决**: 安装Python 3.10或更高版本
**下载**: https://www.python.org/downloads/

### 错误2: "权限被拒绝"
**解决**: 以管理员身份运行脚本

### 错误3: "网络连接超时"
**解决**: 
1. 检查网络连接
2. 使用国内镜像源
3. 使用VPN

### 错误4: "模块导入失败"
**解决**: 
1. 检查代码语法错误
2. 确保所有文件完整
3. 重新安装依赖

### 错误5: "虚拟环境路径不一致" ⭐ 已优化
**现象**: `.venv/pyvenv.cfg` 中的 `executable` 路径与当前Python不一致
**解决**: 
1. 运行 `setup_venv.bat` 或 `setup_venv.ps1`（已整合路径检查功能）
2. 工具会自动检测路径差异并重建虚拟环境
3. 确保 `pyvenv.cfg` 中的路径与当前系统Python一致

## 💡 最佳实践

1. **项目迁移前**: 记录当前Python版本和依赖列表
2. **定期检查**: 每月运行一次环境检查
3. **备份配置**: 保留requirements.txt文件
4. **版本控制**: 不要提交.venv目录到Git
5. **文档更新**: 记录特殊依赖或配置要求

## 📞 技术支持

如果遇到脚本无法解决的问题：
1. 查看脚本输出的详细错误信息
2. 检查Python和pip版本
3. 手动创建虚拟环境进行对比测试
4. 查看项目日志文件